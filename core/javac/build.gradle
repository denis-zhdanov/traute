import org.gradle.internal.jvm.Jvm

plugins {
    id "com.jfrog.bintray" version '1.7.3'
}

dependencies {
    compileOnly files(Jvm.current().toolsJar)
    compileOnly project(':core:common')

    testCompile project(':core:test-common').sourceSets.test.output
    testCompile project(path: ':core:test-common', configuration: 'testCompile')
}

jar {
    into('/')
    from { configurations.compileOnly.filter {it.name.contains('common')}.collect { it.isDirectory() ? it : zipTree(it) } }
}

archivesBaseName = 'traute-javac'
version = '1.0.3'

uploadArchives {
    repositories {
        mavenDeployer {
            pom.project {
                name 'Traute Javac Plugin'
                description 'A Javac plugin which inserts null-checks into generated bytecode'
                url 'http://traute.oss.harmonysoft.tech/core/javac/'
            }
        }
    }
}

bintray {
    user = bintrayUser
    key = bintrayApiKey
    publications = ['MyPublication']

    pkg {

        repo = 'harmonysoft.tech'
        name = archivesBaseName
        licenses = ['MIT']
        vcsUrl = 'https://github.com/denis-zhdanov/traute.git'

        version {
            name = version
            released  = new Date()
        }
    }
}